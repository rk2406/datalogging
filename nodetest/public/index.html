<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>        
    </head>
 
    <body>
        <h1>Communication with socket.io!</h1>
        <div id="chartContainer" style="height: 300px; width: 100%;"></div>
        <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
        <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script> 
        <script>
            var socket = io.connect('http://localhost:3333');
            var dataPoints1 = []
	    var dataPoints2 = []
            socket.on('ping', function(real_data){
		
                 var chart = new CanvasJS.Chart("chartContainer", {
	            zoomEnabled: true,
 	            title: {
 		            text: "Datalogger"
 	            },
                 axisX: {
                     title: "chart updates every 1 sec"
                 },
                 axisY:{
                     includeZero: false
                 }, 
                 legend: {
                     cursor:"pointer",
                     verticalAlign: "top",
                     fontSize: 22,
                     fontColor: "dimGrey",
                     itemclick : toggleDataSeries
                },
                 data: [{ 
                     type: "line",
                     xValueType: "dateTime",
                     //yValueFormatString: "$####.00",
                    xValueFormatString: "hh:mm:ss TT",
                     showInLegend: true,
                   name: "Company A",
                     dataPoints: dataPoints1
                     },
		     { 
                     type: "line",
                     xValueType: "dateTime",
                     //yValueFormatString: "$####.00",
                    xValueFormatString: "hh:mm:ss TT",
                     showInLegend: true,
                   name: "Company B",
                     dataPoints: dataPoints2
                     }
                 ]
             });

 function toggleDataSeries(e) {
 	if (typeof(e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
 		e.dataSeries.visible = false;
 	}
 	else {
 		e.dataSeries.visible = true;
 	}
 	chart.render();
 }

 var updateInterval = 1000;
 // initial value
 var yValue1 ,yvalue2; 

 var time = new Date;
 // starting at 9.30 am
 time.setHours(22);
 time.setMinutes(36);
 time.setSeconds(00);
time.setMilliseconds(00);

 function updateChart() {
	let count;
 	 count = count || 1;
	 for (var i = 0; i < count; i++) {
 		time.setTime(time.getTime()+ updateInterval);
 	// adding random value and rounding it to two digits. 
 	    yValue1 = +(real_data.globe);
	    yValue2 = +(real_data.final);
     //console.log(dataPoints1);
 	// pushing the new values
         dataPoints1.push({
             x: new Date().getTime(),
             y: yValue1
         });
	dataPoints2.push({
	     x: new Date().getTime(),
	     y: yValue2
         });
	 }

 	// updating legend text with  updated with y Value 
 	chart.options.data[0].legendText = " data:" + yValue1;
        chart.options.data[1].legendText = " data:" + yValue2;

 	chart.render();
 }
// generates first set of dataPoints 
 updateChart();	
 setInterval(function(){updateChart()}, updateInterval);
})
        </script>
    </body>
</html>
